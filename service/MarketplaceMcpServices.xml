<?xml version="1.0" encoding="UTF-8"?>
<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-definition-3.xsd">

    <!-- Marketplace MCP对话处理服务 -->
    <service verb="process" noun="MarketplaceMessage">
        <description>处理marketplace对话消息</description>
        <in-parameters>
            <parameter name="sessionId" required="true"/>
            <parameter name="message" required="true"/>
            <parameter name="merchantId" required="true"/>
            <parameter name="messageType" default-value="user"/>
        </in-parameters>
        <out-parameters>
            <parameter name="aiResponse"/>
            <parameter name="intent"/>
            <parameter name="success"/>
            <parameter name="matches"/>
            <parameter name="listingId"/>
            <parameter name="error"/>
        </out-parameters>
        <actions>
            <script location="component://moqui-mcp/src/main/groovy/MarketplaceMcpServices.groovy#processMarketplaceMessage"/>
        </actions>
    </service>

    <!-- 创建marketplace会话 -->
    <service verb="create" noun="MarketplaceSession">
        <description>创建新的marketplace AI对话会话</description>
        <in-parameters>
            <parameter name="sessionId"/>
            <parameter name="merchantId" required="true"/>
            <parameter name="initialContext"/>
        </in-parameters>
        <out-parameters>
            <parameter name="sessionId"/>
            <parameter name="status"/>
            <parameter name="message"/>
        </out-parameters>
        <actions>
            <script location="component://moqui-mcp/src/main/groovy/MarketplaceMcpServices.groovy#createMarketplaceSession"/>
        </actions>
    </service>

    <!-- 获取marketplace会话信息 -->
    <service verb="get" noun="MarketplaceSession">
        <description>获取marketplace会话详情</description>
        <in-parameters>
            <parameter name="sessionId" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="session"/>
            <parameter name="recentMessages"/>
            <parameter name="messageCount"/>
        </out-parameters>
        <actions>
            <script location="component://moqui-mcp/src/main/groovy/MarketplaceMcpServices.groovy#getMarketplaceSession"/>
        </actions>
    </service>

    <!-- 更新marketplace会话 -->
    <service verb="update" noun="MarketplaceSession">
        <description>更新marketplace会话信息</description>
        <in-parameters>
            <parameter name="sessionId" required="true"/>
            <parameter name="currentPhase"/>
            <parameter name="context"/>
            <parameter name="status"/>
            <parameter name="lastListingId"/>
            <parameter name="preferredCategories"/>
        </in-parameters>
        <out-parameters>
            <parameter name="sessionId"/>
            <parameter name="status"/>
            <parameter name="message"/>
        </out-parameters>
        <actions>
            <script location="component://moqui-mcp/src/main/groovy/MarketplaceMcpServices.groovy#updateMarketplaceSession"/>
        </actions>
    </service>

    <!-- 聊天消息处理（简化接口） -->
    <service verb="chat" noun="Message">
        <description>处理marketplace聊天消息</description>
        <in-parameters>
            <parameter name="sessionId" required="true"/>
            <parameter name="message" required="true"/>
            <parameter name="merchantId" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="aiResponse"/>
            <parameter name="intent"/>
            <parameter name="success"/>
            <parameter name="error"/>
        </out-parameters>
        <actions>
            <script location="component://moqui-mcp/src/main/groovy/MarketplaceMcpServices.groovy#chatMessage"/>
        </actions>
    </service>

    <!-- 智能推荐服务 -->
    <service verb="get" noun="SmartRecommendations">
        <description>获取商家智能推荐</description>
        <in-parameters>
            <parameter name="merchantId" required="true"/>
            <parameter name="maxResults" type="Integer" default="5"/>
            <parameter name="minScore" type="BigDecimal" default="0.6"/>
        </in-parameters>
        <out-parameters>
            <parameter name="success"/>
            <parameter name="recommendations"/>
            <parameter name="totalCount"/>
            <parameter name="merchantId"/>
            <parameter name="error"/>
        </out-parameters>
        <actions>
            <script location="component://moqui-mcp/src/main/groovy/MarketplaceMcpServices.groovy#getSmartRecommendations"/>
        </actions>
    </service>

    <!-- 商家行为分析服务 -->
    <service verb="analyze" noun="MerchantBehavior">
        <description>分析商家行为和活跃度</description>
        <in-parameters>
            <parameter name="merchantId" required="true"/>
            <parameter name="days" type="Integer" default="30"/>
        </in-parameters>
        <out-parameters>
            <parameter name="success"/>
            <parameter name="merchantId"/>
            <parameter name="analyzePeriod"/>
            <parameter name="supplyCount"/>
            <parameter name="demandCount"/>
            <parameter name="chatCount"/>
            <parameter name="activityScore"/>
            <parameter name="activityLevel"/>
            <parameter name="analysis"/>
            <parameter name="error"/>
        </out-parameters>
        <actions>
            <script location="component://moqui-mcp/src/main/groovy/MarketplaceMcpServices.groovy#analyzeMerchantBehavior"/>
        </actions>
    </service>

</services>